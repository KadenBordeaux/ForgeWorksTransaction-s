<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Minecraft Build Orders</title>
    <style>
        body { font-family: system-ui,Segoe UI,Roboto,Arial; padding:20px; max-width:900px; margin:auto; }
        h1 { margin-bottom:8px; }
        form { display:flex; gap:10px; flex-wrap:wrap; align-items:end; background:#f7f7f7;padding:12px;border-radius:6px;}
        label { display:flex; flex-direction:column; font-size:13px; min-width:160px; }
        input[type="text"], input[type="number"], select { padding:8px; border:1px solid #ccc; border-radius:4px; }
        input[type="checkbox"] { transform:scale(1.1); margin-top:8px;}
        button { padding:8px 12px; border:none; background:#0066cc; color:#fff; border-radius:5px; cursor:pointer;}
        button.secondary { background:#888; }
        table { width:100%; border-collapse:collapse; margin-top:14px; }
        th, td { padding:8px 10px; border:1px solid #e3e3e3; text-align:left; font-size:14px; }
        th { background:#fafafa; }
        .muted { color:#666; font-size:13px; }
        .actions button { margin-right:6px; }
        @media (max-width:640px){
            form { flex-direction:column; }
            label { min-width:auto; width:100%; }
        }
    </style>
</head>
<body>
    <h1>Minecraft Build Orders</h1>
    <p class="muted">Add orders for players. Orders are saved locally in your browser (localStorage).</p>

    <form id="orderForm">
        <label>
            Order number
            <input id="orderNumber" type="text" required placeholder="e.g. 1001" />
        </label>

        <label>
            Username
            <input id="username" type="text" required placeholder="Minecraft username" />
        </label>

        <label>
            Amount
            <input id="amount" type="number" min="0" step="0.01" required placeholder="e.g. 25.00" />
        </label>

        <label style="align-items:center;">
            <span>Downpayment paid?</span>
            <input id="downpayment" type="checkbox" />
        </label>

        <label>
            Status
            <select id="status">
                <option value="not_started">Not started yet</option>
                <option value="in_progress">In progress</option>
                <option value="waiting_final">Waiting for final payment</option>
                <option value="done">Done</option>
            </select>
        </label>

        <div style="display:flex;gap:8px;">
            <button id="saveBtn" type="submit">Save order</button>
            <button id="clearBtn" type="button" class="secondary">Clear form</button>
        </div>
    </form>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
        <div class="muted" id="countText">0 orders</div>
        <div>
            <button id="exportBtn" type="button" class="secondary">Export JSON</button>
            <button id="importBtn" type="button" class="secondary">Import JSON</button>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
            <button id="clearAllBtn" type="button" class="secondary">Clear all</button>
        </div>
    </div>

    <table id="ordersTable" aria-live="polite">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Username</th>
                <th>Amount</th>
                <th>Downpayment</th>
                <th>Status</th>
                <th class="actions">Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // Simple client-side order manager using localStorage
        const STORAGE_KEY = 'mc_build_orders_v1';

        const form = document.getElementById('orderForm');
        const orderNumberInput = document.getElementById('orderNumber');
        const usernameInput = document.getElementById('username');
        const amountInput = document.getElementById('amount');
        const downpaymentInput = document.getElementById('downpayment');
        const statusSelect = document.getElementById('status');
        const ordersTableBody = document.querySelector('#ordersTable tbody');
        const countText = document.getElementById('countText');
        const clearBtn = document.getElementById('clearBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const importFile = document.getElementById('importFile');

        function loadOrders() {
            try {
                return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            } catch {
                return [];
            }
        }

        function saveOrders(orders) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
            render();
        }

        function render() {
            const orders = loadOrders();
            ordersTableBody.innerHTML = '';
            orders.forEach(o => {
                const tr = document.createElement('tr');

                const amountFormatted = Number(o.amount).toFixed(2);
                const statusLabel = {
                    not_started: 'Not started yet',
                    in_progress: 'In progress',
                    waiting_final: 'Waiting for final payment',
                    done: 'Done'
                }[o.status] || o.status;

                tr.innerHTML = `
                    <td>${escapeHtml(o.orderNumber)}</td>
                    <td>${escapeHtml(o.username)}</td>
                    <td>$${amountFormatted}</td>
                    <td>${o.downpayment ? 'Yes' : 'No'}</td>
                    <td>
                        <select data-order="${escapeHtml(o.orderNumber)}" class="status-select">
                            <option value="not_started" ${o.status==='not_started'?'selected':''}>Not started yet</option>
                            <option value="in_progress" ${o.status==='in_progress'?'selected':''}>In progress</option>
                            <option value="waiting_final" ${o.status==='waiting_final'?'selected':''}>Waiting for final payment</option>
                            <option value="done" ${o.status==='done'?'selected':''}>Done</option>
                        </select>
                    </td>
                    <td class="actions">
                        <button data-action="edit" data-order="${escapeHtml(o.orderNumber)}">Edit</button>
                        <button data-action="delete" data-order="${escapeHtml(o.orderNumber)}">Delete</button>
                    </td>
                `;
                ordersTableBody.appendChild(tr);
            });

            countText.textContent = `${orders.length} order${orders.length===1?'':'s'}`;
            // attach event listeners for newly created elements
            document.querySelectorAll('.status-select').forEach(sel => {
                sel.addEventListener('change', (e) => {
                    const orderNumber = e.target.dataset.order;
                    updateOrder(orderNumber, { status: e.target.value });
                });
            });

            document.querySelectorAll('button[data-action="edit"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const orderNumber = btn.dataset.order;
                    fillFormForEdit(orderNumber);
                });
            });

            document.querySelectorAll('button[data-action="delete"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const orderNumber = btn.dataset.order;
                    if (confirm('Delete order ' + orderNumber + '?')) deleteOrder(orderNumber);
                });
            });
        }

        function addOrUpdateOrder(order) {
            const orders = loadOrders();
            const idx = orders.findIndex(o => o.orderNumber === order.orderNumber);
            if (idx >= 0) {
                orders[idx] = order;
            } else {
                orders.push(order);
            }
            saveOrders(orders);
        }

        function updateOrder(orderNumber, patch) {
            const orders = loadOrders();
            const idx = orders.findIndex(o => o.orderNumber === orderNumber);
            if (idx === -1) return;
            orders[idx] = Object.assign({}, orders[idx], patch);
            saveOrders(orders);
        }

        function deleteOrder(orderNumber) {
            const orders = loadOrders().filter(o => o.orderNumber !== orderNumber);
            saveOrders(orders);
        }

        function fillFormForEdit(orderNumber) {
            const orders = loadOrders();
            const o = orders.find(x => x.orderNumber === orderNumber);
            if (!o) return;
            orderNumberInput.value = o.orderNumber;
            usernameInput.value = o.username;
            amountInput.value = o.amount;
            downpaymentInput.checked = !!o.downpayment;
            statusSelect.value = o.status;
            orderNumberInput.focus();
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const order = {
                orderNumber: orderNumberInput.value.trim(),
                username: usernameInput.value.trim(),
                amount: Number(amountInput.value) || 0,
                downpayment: !!downpaymentInput.checked,
                status: statusSelect.value
            };
            if (!order.orderNumber) { alert('Order number is required.'); return; }
            addOrUpdateOrder(order);
            form.reset();
        });

        clearBtn.addEventListener('click', () => form.reset());

        clearAllBtn.addEventListener('click', () => {
            if (confirm('Clear all saved orders? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                render();
            }
        });

        exportBtn.addEventListener('click', () => {
            const data = JSON.stringify(loadOrders(), null, 2);
            const blob = new Blob([data], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mc_build_orders.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        importBtn.addEventListener('click', () => importFile.click());
        importFile.addEventListener('change', (e) => {
            const f = e.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const imported = JSON.parse(reader.result);
                    if (!Array.isArray(imported)) throw new Error('Invalid file');
                    // merge: overwrite by orderNumber
                    const existing = loadOrders();
                    const map = new Map(existing.map(o => [o.orderNumber, o]));
                    imported.forEach(i => { if (i && i.orderNumber) map.set(i.orderNumber, i); });
                    saveOrders(Array.from(map.values()));
                    importFile.value = '';
                } catch (err) {
                    alert('Failed to import JSON: ' + err.message);
                }
            };
            reader.readAsText(f);
        });

        // escape to avoid accidental HTML injection in table
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // initial render
        render();
    </script>
</body>
</html>